var doogilog=function(e){"use strict";var t="undefined"!=typeof window,n=t&&window.navigator.userAgent.toLowerCase(),r=n&&/msie|trident/.test(n);n&&n.indexOf("msie 9.0"),n&&n.indexOf("edge/");const B=n&&0<n.indexOf("android"),J=n&&/iphone|ipad|ipod|ios/.test(n),q=(n&&n.match(/firefox\/(\d+)/),n&&-1<n.indexOf("micromessenger")),D=n&&-1<n.indexOf("miniprogram");if(t)try{var o={};Object.defineProperty(o,"passive",{get(){}}),window.addEventListener("test-passive",null,o)}catch(e){}function i(e){return"function"==typeof e&&/native code/.test(e.toString())}n="undefined"!=typeof Symbol&&i(Symbol)&&"undefined"!=typeof Reflect&&i(Reflect.ownKeys);"undefined"!=typeof Set&&i(Set);const a=function(){switch(!0){case B||J||q:return"h5";case D:return"xcx";default:return"pc"}}();function s(e){return e.bt=e.bt||Date.now(),e.ba=O.ba,window.encodeURI("?data="+JSON.stringify(e))}t=Symbol();const c=n?t:"ilog9088jhfahfjaahqwe";function d(e){e.a=e.a||O.a,e.ki=e.ki||"app",e.a?(e.e=e.e||a,h(()=>{window[c]=new Image,window[c].onerror=()=>{p(e)},window[c].src=""+O.ilogUrl+s(e)})):p({...e,bt:Date.now()})}function u(e){e.a=e.a||O.a,e.ki=e.ki||"app",e.a?(e.e=e.e||a,h(()=>{window?.navigator?.sendBeacon(""+O.ilogUrl+s(e))})):p({...e,bt:Date.now()})}const l=[];function f(){var e=JSON.parse(JSON.stringify(l));l.length=0,e.forEach(e=>{d(e)})}function p(e){l.push(JSON.parse(JSON.stringify(e)))}let g=null;const v=[],m=[];function w(){m.forEach(e=>e()),m.length=0}function y(e){"function"==typeof e&&m.push(e)}function b(e){"function"==typeof e&&v.push(e)}const z="function"==typeof window.requestIdleCallback?window.requestIdleCallback:e=>setTimeout(e,0),h=e=>z(e);let O={a:"",longResourceTime:100,longApiTime:100,longTaskTime:1e3,viewAsm:"vsm",clickAsm:"csm",mode:"dev",threshold:.5,ilogUrl:"",ba:"",resendInterval:10};o=O.threshold;const k="number"==typeof o&&0<=o&&o<=1?o:.5;n={root:null,rootMargin:"0px",threshold:k};function E({entry:e,target:t,ob:n}){e.intersectionRatio>=k&&(d({asm:t.getAttribute(O.viewAsm),et:"view",ki:"app"}),n.unobserve(t),t.removeAttribute(""+O.viewAsm))}const T=new IntersectionObserver(async function(e,n){e.forEach(async function(e){var t=e["target"];"img"===t?.tagName.toLowerCase()?function e({entry:t,target:n,ob:r},o=1){n?.complete?E({entry:t,target:n,ob:r}):0<o?(o--,setTimeout(()=>{e({entry:t,target:n,ob:r},o)},500)):r.unobserve(n)}({entry:e,target:t,ob:n},1):E({entry:e,target:t,ob:n})})},n);function A(e){var t;1!==(t=e)?.nodeType||"none"===t?.style?.display||"hidden"===t?.style?.visibility||"0"===t?.style?.opacity||e.getAttribute("ilog_intersectionObserver_tag")||(e.setAttribute("ilog_intersectionObserver_tag","1"),T.observe(e))}const I=new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)(async function(e){e.forEach(async function(e){var t,n=e["target"];"childList"===e.type&&e?.addedNodes?.length?0<(t=Array.from(document.querySelectorAll(`[${O.viewAsm}]`)).filter(e=>e?.getAttribute(""+O.viewAsm))).length&&t.forEach(e=>A(e)):"attributes"===e.type&&n?.getAttribute(""+O.viewAsm)&&A(n)})}),P={subtree:!0,attributes:!0,childList:!0,attributeFilter:[""+O.viewAsm,"style"]},S=!r&&"undefined"!=typeof MutationObserver&&(i(MutationObserver)||"[object MutationObserverConstructor]"===MutationObserver.toString()),x=!r&&"undefined"!=typeof IntersectionObserver&&(i(IntersectionObserver)||"[object IntersectionObserverConstructor]"===IntersectionObserver.toString());function L(){S&&x&&I.observe(document.body,P)}let N=void 0;function C(e){e=(N=e).target;null!==e?.getAttribute(""+O.clickAsm)&&d({ki:"app",et:"click",asm:e?.getAttribute(""+O.clickAsm)})}function R(e){N=e}function M(e){if(e&&!e.includes("click")||window.addEventListener("click",C),e&&!e.includes("input")||window.addEventListener("input",R),!e||e.includes("pageusetime")){const t=Date.now();y(()=>{}),b(()=>{u({ki:"app",et:"timing",hr:window.location.origin,ext:{timing:Date.now()-t}})})}}const _="undefined"!=typeof IntersectionObserver&&(i(IntersectionObserver)||"[object IntersectionObserverConstructor]"===IntersectionObserver.toString());let j;function F(e){e.getEntriesByType("longtask").filter(e=>e.duration>(O.longTaskTime||50)).forEach(e=>{d({ki:"per",ext:{perType:"longTask",eventType:N?.type,duration:Math.round(e.duration),selector:N?function(e){for(var t=[];e&&"body"!==e?.nodeName?.toLowerCase();)t.push(e),e=e.parentNode;return JSON.stringify(t.filter(e=>e!==document&&e!==window).map(e=>{var t=e.nodeName.toLowerCase();return e.className&&"string"==typeof e.className?t+"."+e.className.split(" ").join("."):t}))}(N?.target):""}})})}function K(e){let n=[];for(e.getEntriesByType("resource").filter(e=>-1===["fetch","xmlhttprequest","beacon"].indexOf(e?.initiatorType)&&e.duration>(O.longResourceTime||30)).forEach(e=>{var t;e.name.includes(O.ilogUrl)||n.push({isCache:0===(t=e).transferSize||0!==t.transferSize&&0===t.encodedBodySize,url:encodeURIComponent(e.name),duration:Math.round(e.duration),initiatorType:e.initiatorType||""})});n.length;)d({ki:"per",ext:{perType:"longResource",data:n.splice(0,20)}})}function H(){var e,t,n,r,o,i;performance.timing&&({responseStart:o,navigationStart:e,responseEnd:i,domContentLoadedEventEnd:t,domInteractive:n,loadEventEnd:r}=performance.timing,i={whiteScreen:o-e,firstPackage:i-e,firstScreen:(o=performance.getEntriesByName("first-contentful-paint")[0])?.startTime,htmlLoad:t-e,firstUx:n-e,pageLoad:r-e,FCP:o,timing:performance.timing},d({ki:"per",ua:navigator.userAgent,ext:{perType:"crux",data:i}}))}function U({sendBeacon:e}){var t=performance["memory"];t&&(e?u:d)({ki:"per",ua:navigator.userAgent,ext:{perType:"memory",data:t}})}function W(t){(j=new PerformanceObserver(e=>{t&&!t.includes("longApi")||e.getEntriesByType("resource").filter(e=>-1<["fetch","xmlhttprequest"].indexOf(e.initiatorType)&&e.duration>(O.longApiTime||50)).forEach(e=>{d({ki:"per",ext:{perType:"longApi",data:{duration:Math.round(e.duration),url:encodeURIComponent(e.name)}}})}),t&&!t.includes("longResource")||K(e),t&&!t.includes("longTask")||F(e)})).observe({entryTypes:["resource","longtask"]})}function $(e){_&&W(e),e&&!e.includes("memory")||(y(()=>U({})),b(()=>U({sendBeacon:!0}))),e&&!e.includes("crux")||y(()=>h(H))}function G(e){e=e.target;(e?.src||e?.href)&&d({ki:"err",ext:{errType:"resourceErr",filename:e?.src||e?.href,tagName:e?.tagName.toLowerCase()}})}function Q(e){e.preventDefault()}function V(){window.onerror=function(e,t,n,r,o){d({ki:"err",ext:{errType:"jsErr",filename:t,position:n+"."+r,message:"string"==typeof e?e:"",stack:o?.stack?.slice(0,100)}})},window.addEventListener("error",G),window.addEventListener("unhandledrejection",Q)}function X(){b(()=>{S&&x&&(I.disconnect(),T.disconnect()),window.removeEventListener("unhandledrejection",Q),window.removeEventListener("error",G),j?.disconnect(),window.removeEventListener("click",C),window.removeEventListener("input",R),N=void 0})}return"complete"===document.readyState?w():window.addEventListener("load",w),window.addEventListener("pagehide",e=>{v.forEach(e=>e()),v.length=0,m.length=0,window.clearInterval(g),g=null},!1),b(function(){var e=JSON.parse(JSON.stringify(l));l.length=0,e.forEach(e=>{u(e)}),l.length=0}),e.autoAllObserve=function(){V(),L(),$(),M(),X()},e.errorObserveRun=V,e.ilog=d,e.initIlogConfig=function(e){O={...O,...e},e.ilogUrl?(f(),window.clearInterval(g),O.resendInterval&&"number"==typeof O.resendInterval&&(O.resendInterval=O.resendInterval<1?10:O.resendInterval,g=setInterval(f,60*O.resendInterval*1e3))):console.error("ilogUrl is must !")},e.mutationRun=L,e.pagehideCallbackCollecter=b,e.perfObserveRun=$,e.removeObserveOnleave=X,e.sendBeaconHandler=u,e.uxObserveRun=M,e}({});

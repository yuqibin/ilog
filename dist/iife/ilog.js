var doogilog=function(){"use strict";var e="undefined"!=typeof window,t=e&&window.navigator.userAgent.toLowerCase(),n=t&&/msie|trident/.test(t);t&&t.indexOf("msie 9.0"),t&&t.indexOf("edge/");const B=t&&0<t.indexOf("android"),J=t&&/iphone|ipad|ipod|ios/.test(t),q=(t&&t.match(/firefox\/(\d+)/),t&&-1<t.indexOf("micromessenger")),D=t&&-1<t.indexOf("miniprogram");if(e)try{var r={};Object.defineProperty(r,"passive",{get(){}}),window.addEventListener("test-passive",null,r)}catch(e){}function o(e){return"function"==typeof e&&/native code/.test(e.toString())}t="undefined"!=typeof Symbol&&o(Symbol)&&"undefined"!=typeof Reflect&&o(Reflect.ownKeys);"undefined"!=typeof Set&&o(Set);const i=function(){switch(!0){case B||J||q:return"h5";case D:return"xcx";default:return"pc"}}();function a(e){return e.bt=e.bt||Date.now(),e.ba=h.ba,window.encodeURI("?data="+JSON.stringify(e))}e=Symbol();const s=t?e:"ilog9088jhfahfjaahqwe";function c(e){e.a=e.a||h.a,e.ki=e.ki||"app",e.a?(e.e=e.e||i,b(()=>{window[s]=new Image,window[s].onerror=()=>{f(e)},window[s].src=""+h.ilogUrl+a(e)})):f({...e,bt:Date.now()})}function d(e){e.a=e.a||h.a,e.ki=e.ki||"app",e.a?(e.e=e.e||i,b(()=>{window?.navigator?.sendBeacon(""+h.ilogUrl+a(e))})):f({...e,bt:Date.now()})}const u=[];function l(){var e=JSON.parse(JSON.stringify(u));u.length=0,e.forEach(e=>{c(e)})}function f(e){u.push(JSON.parse(JSON.stringify(e)))}let p=null;const g=[],v=[];function m(){v.forEach(e=>e()),v.length=0}function w(e){"function"==typeof e&&v.push(e)}function y(e){"function"==typeof e&&g.push(e)}const z="function"==typeof window.requestIdleCallback?window.requestIdleCallback:e=>setTimeout(e,0),b=e=>z(e);let h={a:"",longResourceTime:30,longApiTime:5,longTaskTime:50,viewAsm:"vsm",clickAsm:"csm",mode:"dev",threshold:.5,ilogUrl:"",ba:"",resendInterval:10};let O=void 0;function k(e){e=(O=e).target;null!==e?.getAttribute(""+h.clickAsm)&&c({ki:"app",et:"click",asm:e?.getAttribute(""+h.clickAsm)})}function E(e){O=e}function T(e){if(e.includes("click")&&window.addEventListener("click",k),e.includes("input")&&window.addEventListener("input",E),e.includes("pageusetime")){const t=Date.now();w(()=>{}),y(()=>{d({ki:"app",et:"timing",hr:window.location.origin,ext:{timing:Date.now()-t}})})}}r=h.threshold;const I="number"==typeof r&&0<=r&&r<=1?r:.5;t={root:null,rootMargin:"0px",threshold:I};function A({entry:e,target:t,ob:n}){e.intersectionRatio>=I&&(c({asm:t.getAttribute(h.viewAsm),et:"view",ki:"app"}),n.unobserve(t),t.removeAttribute(""+h.viewAsm))}const S=new IntersectionObserver(async function(e,n){e.forEach(async function(e){var t=e["target"];"img"===t?.tagName.toLowerCase()?function e({entry:t,target:n,ob:r},o=1){n?.complete?A({entry:t,target:n,ob:r}):0<o?(o--,setTimeout(()=>{e({entry:t,target:n,ob:r},o)},500)):r.unobserve(n)}({entry:e,target:t,ob:n},1):A({entry:e,target:t,ob:n})})},t);function x(e){var t;1!==(t=e)?.nodeType||"none"===t?.style?.display||"hidden"===t?.style?.visibility||"0"===t?.style?.opacity||e.getAttribute("ilog_intersectionObserver_tag")||(e.setAttribute("ilog_intersectionObserver_tag","1"),S.observe(e))}const L=new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)(async function(e){e.forEach(async function(e){var t,n=e["target"];"childList"===e.type&&e?.addedNodes?.length?0<(t=Array.from(document.querySelectorAll(`[${h.viewAsm}]`)).filter(e=>e?.getAttribute(""+h.viewAsm))).length&&t.forEach(e=>x(e)):"attributes"===e.type&&n?.getAttribute(""+h.viewAsm)&&x(n)})}),P={subtree:!0,attributes:!0,childList:!0,attributeFilter:[""+h.viewAsm,"style"]},C=!n&&"undefined"!=typeof MutationObserver&&(o(MutationObserver)||"[object MutationObserverConstructor]"===MutationObserver.toString()),N=!n&&"undefined"!=typeof IntersectionObserver&&(o(IntersectionObserver)||"[object IntersectionObserverConstructor]"===IntersectionObserver.toString());function R(){C&&N&&L.observe(document.body,P)}const _="undefined"!=typeof IntersectionObserver&&(o(IntersectionObserver)||"[object IntersectionObserverConstructor]"===IntersectionObserver.toString());let j;function H(e){e.getEntriesByType("longtask").filter(e=>e.duration>(h.longTaskTime||50)).forEach(e=>{c({ki:"per",ext:{perType:"longTask",eventType:O?.type,duration:Math.round(e.duration),selector:O?function(e){for(var t=[];e&&"body"!==e?.nodeName?.toLowerCase();)t.push(e),e=e.parentNode;return JSON.stringify(t.filter(e=>e!==document&&e!==window).map(e=>{var t=e.nodeName.toLowerCase();return e.className&&"string"==typeof e.className?t+"."+e.className.split(" ").join("."):t}))}(O?.target):""}})})}function F(e){let n=[];for(e.getEntriesByType("resource").filter(e=>-1===["fetch","xmlhttprequest","beacon"].indexOf(e?.initiatorType)&&e.duration>(h.longResourceTime||30)).forEach(e=>{var t;e.name.includes(h.ilogUrl)||n.push({isCache:0===(t=e).transferSize||0!==t.transferSize&&0===t.encodedBodySize,url:encodeURIComponent(e.name),duration:Math.round(e.duration),initiatorType:e.initiatorType||""})});n.length;)c({ki:"per",ext:{perType:"longResource",data:n.splice(0,20)}})}function K(){var e,t,n,r,o,i;performance.timing&&({responseStart:o,navigationStart:e,responseEnd:i,domContentLoadedEventEnd:t,domInteractive:n,loadEventEnd:r}=performance.timing,i={whiteScreen:o-e,firstPackage:i-e,firstScreen:(o=performance.getEntriesByName("first-contentful-paint")[0])?.startTime,htmlLoad:t-e,firstUx:n-e,pageLoad:r-e,FCP:o,timing:performance.timing},c({ki:"per",ua:navigator.userAgent,ext:{perType:"crux",data:i}}))}function M({sendBeacon:e}){var t=performance["memory"];t&&(e?d:c)({ki:"per",ua:navigator.userAgent,ext:{perType:"memory",data:t}})}function W(){(j=new PerformanceObserver(e=>{e.getEntriesByType("resource").filter(e=>-1<["fetch","xmlhttprequest"].indexOf(e.initiatorType)&&e.duration>(h.longApiTime||50)).forEach(e=>{c({ki:"per",ext:{perType:"longApi",data:{duration:Math.round(e.duration),url:encodeURIComponent(e.name)}}})}),F(e),H(e)})).observe({entryTypes:["resource","longtask"]})}function U(){_&&W(),w(()=>b(K)),w(()=>M({})),y(()=>M({sendBeacon:!0}))}function $(e){e=e.target;(e?.src||e?.href)&&c({ki:"err",ext:{errType:"resourceErr",filename:e?.src||e?.href,tagName:e?.tagName.toLowerCase()}})}function G(e){e.preventDefault()}function Q(){window.onerror=function(e,t,n,r,o){c({ki:"err",ext:{errType:"jsErr",filename:t,position:n+"."+r,message:"string"==typeof e?e:"",stack:o?.stack?.slice(0,100)}})},window.addEventListener("error",$),window.addEventListener("unhandledrejection",G)}function V(){y(()=>{C&&N&&(L.disconnect(),S.disconnect()),window.removeEventListener("unhandledrejection",G),window.removeEventListener("error",$),j?.disconnect(),window.removeEventListener("click",k),window.removeEventListener("input",E),O=void 0})}"complete"===document.readyState?m():window.addEventListener("load",m),window.addEventListener("pagehide",e=>{g.forEach(e=>e()),g.length=0,v.length=0,window.clearInterval(p),p=null},!1),y(function(){var e=JSON.parse(JSON.stringify(u));u.length=0,e.forEach(e=>{d(e)}),u.length=0});const X={initIlogConfig:function(e){h={...h,...e},e.ilogUrl?(l(),window.clearInterval(p),h.resendInterval&&"number"==typeof h.resendInterval&&(h.resendInterval=h.resendInterval<1?10:h.resendInterval,p=setInterval(l,60*h.resendInterval*1e3))):console.error("ilogUrl is must !")},autoAllObserve:function(){Q(),R(),U(),T(["click","input"]),V()},mutationRun:R,vueErrorHandle:function(e){c({ki:"err",ext:{errType:"jsErr",message:e?.message,stack:e?.stack}})},uxObserveRun:T,errorObserveRun:Q,perfObserveRun:U,routerChangeHandle:function(){c({ki:"app",et:"pv",hr:encodeURIComponent(location.href)})},removeObserveOnleave:V,pagehideCallbackCollecter:y,sendBeaconHandler:d};return Object.keys(X).forEach(e=>{c[e]=X[e]}),c}();
